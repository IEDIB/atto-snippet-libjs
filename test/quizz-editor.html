<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css"
    integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"
    integrity="sha512-5A8nwdMOWrSz20fDsjczgUidUBR8liPYU+WymTZP1lmY9G6Oc7HlZv156XqnsgNUzTyMefFTcsFH/tnJE/+xBg=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      max-width: 700px;
      margin: auto;
    }
  </style>
</head>

<body class="editing">

  <!--this becomes the atto mock editor-->
  <div id="content-editor-mock" class="editor_atto_content">

    <div class="iedib-tasca-exercici">

      <button id="edit-group1">Edit this group 1</button>
      <button data-cmd="dropdown" data-grp="1">Add dropdown</button>
      <button data-cmd="mchoice" data-grp="1">Add mchoice</button>
      <button data-cmd="numeric" data-grp="1">Add numeric</button>
      <button data-cmd="cloze" data-grp="1">Add cloze</button>
      <button data-cmd="mathquill" data-grp="1">Add mathquill</button>
    
      <div id="group1" data-quizz-group="eyJzIjoiI2E9MyIsIm8iOnsiaGludCI6IjIiLCJhbnMiOiI0In19" data-lang="en" >
        1+1=<ib-quizz-numeric data-src="eyJpbmkiOiIiLCJhbnMiOiIjYSIsIm9wdHMiOnsiZXJyIjoiMCIsImVycnVuaXQiOiJhYnNvbHV0ZSJ9LCJoaW50IjoiIiwiZmJrIjoiIiwicHJlIjoiIn0=" class="ib-quizz-elem" style="display: inline-block;"></ib-quizz-numeric>
      </div>


      <hr>

      <button id="edit-group2">Edit this group 2</button>
      <button data-cmd="dropdown" data-grp="2">Add dropdown</button>
      <button data-cmd="mchoice" data-grp="2">Add mchoice</button>
      <button data-cmd="numeric" data-grp="2">Add numeric</button>
      <button data-cmd="cloze" data-grp="2">Add cloze</button>
      <button data-cmd="mathquill" data-grp="2">Add mathquill</button>
     
       
      <div id="group2" data-quizz-group="eyJzIjoiI21hdDEgPSBOKCdhbGVhUmVndWxhck1hdHJpeCgyLDQpJyk7ICIsIm8iOnsiaGludCI6MiwiYW5zIjo0fX0=" data-lang="ca"> 
        <p>Donada la matriu $A=\left( #mat1 \right) $ .</p>
        <p>a) Calcula el seu determinant. <ib-quizz-mathquill class="ib-quizz-elem ib-enable-future" data-src="eyJpbmkiOiIiLCJ2YXJzIjpbImRldFZhbDo9ZGV0ZXJtaW5hbnQoI21hdDEpIl0sImNmbiI6IiIsImFucyI6ImRldFZhbCIsImhpbnQiOiIiLCJmYmsiOiIiLCJwcmUiOiIifQ=="></ib-quizz-mathquill> </p>
        <p>b) Calcula la seva inversa.
        <ib-quizz-mathquill class="ib-quizz-elem ib-enable-future" data-src="eyJpbmkiOiJNWzJ4Ml0iLCJ2YXJzIjpbInJlc3BvbnNlOj1pbnZlcnQoI21hdDEpIl0sImNmbiI6IiIsImFucyI6InJlc3BvbnNlIiwiaGludCI6IkNhbGN1bGEgZWwgZGV0ZXJtaW5hbnQgaSBjb21wcm92YSBxdWUgZG9uYSBkaWZlcmVudCBkZSB6ZXJvLiIsImZiayI6IiIsInByZSI6IlxcKEFeey0xfT1cXCkifQ=="></ib-quizz-mathquill>
        </p>
      </div>




  </div>

  <button id="codegen">Get HTML to test</button><br>

  <textarea id="codegenarea" style="width: 99%;" rows="15"></textarea>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
    crossorigin="anonymous"></script>

  <script>
    //fake requirejs
    window.require = function (deps, cb) {
      cb(jQuery);
    };
    window.requirejs = window.require;
  </script>


  <script src="./dist-dev/quizz-editor.js"></script>
  <script>

    const generateCode = function() {
      const raw = $('.editor_atto_content').html().trim()
      const out = raw.replace(/data-active="1"/g, '')
        .replace(/<button[^>]*>([^<>]*?)<\/button>/g, '')
        .replace(/^\s*\n+/gm,'\n'); 
      return out;
    }

    $(function () {
      $('[data-toggle="tooltip"]').tooltip();
      $('#edit-group1').on('click', function () {
        document.querySelector('#group1').dispatchEvent(new Event('editorRequest'));
      });
      $('#edit-group2').on('click', function () {
        document.querySelector('#group2').dispatchEvent(new Event('editorRequest'));
      });
      document.querySelector('.editor_atto_content').addEventListener('updated', function () {
        console.log("The mock atto editor has recieved an update event");
        $('#codegenarea').val(generateCode());
      });

      $('#codegen').on('click', function () {
        $('#codegenarea').val(generateCode());
      });

      $("button[data-cmd]").each((i, elem)=> {
        $(elem).on('click', (evt) => {
          const cmd = $(elem).attr("data-cmd");
          const grp = parseInt($(elem).attr("data-grp") || '1');
          const groupDivs = [$('#group1'), $('#group2')];
          const paragraph = $('<p>Fake text <ib-quizz-'+cmd+' data-quizz=""></ib-quizz-'+cmd+'></p>')
          groupDivs[grp-1].append(paragraph);
        });
      })
    }) 
  </script>
</body>

</html>
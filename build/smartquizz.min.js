window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; !function(){function handleInteraction(elem,data,ds,revisited){if(console.log("handle interaction"),console.log(data,ds),ds.collapse)for(var rules=ds.collapse.split(";"),ir=0,lr=rules.length;lr>ir;ir++){for(var rule=rules[ir],ruleParts=rule.split(":"),secname=ruleParts[0].trim(),pregrules=ruleParts[1].trim(),fullfilled=!0,conditions=pregrules.split("+"),ic=0,lc=conditions.length;lc>ic;ic++){var preg=conditions[ic].trim();if(data.preguntes[preg]<5){fullfilled=!1;break}}if(fullfilled){console.log("Must collapse ",secname);var component=findSectionByname(secname);component&&component.hide()}}if(ds.growl)for(var growls=ds.growl.split(";"),ir=0,lr=growls.length;lr>ir;ir++){var rule=growls[ir],ruleParts=rule.split(":"),text=ruleParts[0].trim(),condition=ruleParts[1].trim(),fullfilled=eval(""+data.score+condition);if(fullfilled){if(revisited||console.log("Must say aloud if not revisited ",text),hasOverlay){var overlay=new Overlay(elem);overlay.back(!0),overlay.msg(text)}break}}if(ds.scroll)for(var scrolls=ds.scroll.split(";"),ir=0,lr=scrolls.length;lr>ir;ir++){var scroll=scrolls[ir],ruleParts=scroll.split(":"),sec=ruleParts[0].trim(),condition=ruleParts[1].trim(),fullfilled=eval(""+data.score+condition);if(fullfilled){if(!revisited){console.log("Must scroll to ",sec);var aTag=$("a[name='"+sec+"']");$("html,body").animate({scrollTop:aTag.offset().top},"fast")}console.log("I would not go to ",sec);break}}}function initApi(e){var l=function(e){if(!e)return"";if("object"!=typeof e)return e;for(var l=Object.keys(e),t="",r=0,o=l.length;o>r;r++)t+=e[l[r]]+" ";return t},t=document.querySelector('[role="smartquizz"]'),r=t.querySelector("iframe");if(r){var o=r.contentWindow;console.log(o);var i=o.document.querySelector("iframe.h5p-iframe");if(console.log(i),!i)return!1;i=i.contentWindow,console.log(i);var a=i.H5P;if(console.log(a),!a)return console.log("NO H5P trying latter"),!1;var n={};return a.externalDispatcher.on("xAPI",function(r){console.log(r);var o=r.data,i=o.statement,a=i.verb.id,s=i.result,c="http://adlnet.gov/expapi/verbs/completed"==a,d=l(i.object.definition.name).trim(),u=10*r.getScore()/r.getMaxScore();if(n[d]=u,hasIAPace&&e.dataset.category&&IB.iapace.addScore(e.dataset.category,u),c){t.style.display="none",$("#main_hidden").css("display","block");var f={completion:s.completion,success:s.success,score:10*s.score.scaled,preguntes:n};hasIAPace&&IB.iapace.saveInitialEval(e.dataset.id,f),handleInteraction(e,f,t.dataset,!1)}}),!0}}var hasSections=null!=window.IB.sd.sections,hasIAPace=null!=window.IB&&null!=window.IB.iapace,hasOverlay=null!=window.Overlay,findSectionByname=function(e){return hasSections?IB.sd.sections.inst["#"+e]:null},COMPONENT_NAME="dynamic_smartquizz";if(window.IB.sd[COMPONENT_NAME])return console.error("Warning: "+COMPONENT_NAME+" loaded twice."),void(window.IB.sd[COMPONENT_NAME].bind&&window.IB.sd[COMPONENT_NAME].bind());var FunctionAttemptExec=function(e,l,t,r){var o=e(r);!o&&l>0&&window.setTimeout(function(){FunctionAttemptExec(e,l-1,t,r)},t)},alias={author:"Josep Mulet",version:"1.0",inst:{}};window.IB.sd[COMPONENT_NAME]=alias;var bind=function(){for(var e=document.querySelectorAll('[role="smartquizz"]'),l=0,t=e.length;t>l;l++)if(!e[l].dataset.active){e[l].dataset.active="1";var r=e[l].dataset.id;if(r&&hasIAPace){var o=IB.iapace.loadInitialEval(r);o?(console.log(o),handleInteraction(e[l],o,e[l].dataset,!0)):FunctionAttemptExec(initApi,5,1e3,e[l])}}};alias.bind=bind,alias.unbind=function(){console.error("Not implemented")},bind()}();
window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; !function(){var a={},e=' .pw-laser-nw{position:relative;}\n .pw-laser-nw::after{content:"";position:absolute;left:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ';e+=' .pw-laser-ne{position:relative;}\n .pw-laser-ne::after{content:"";position:absolute;right:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-sw{position:relative;}\n .pw-laser-sw::after{content:"";position:absolute;left:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;} \n',e+=' .pw-laser-se{position:relative;}\n .pw-laser-se::after{content:"";position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-md{position:relative;}\n .pw-laser-md::after{content:"";position:absolute;left:50%;bottom:50%;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=" .audible-media-player{max-width:600px;padding:6px;border-radius:7px;display:flex;margin:auto;margin-bottom:15px;}\n ",e+="  \n .audible-frog span, .audible-frog button{color: #4f6e46;}\n .audible-sky{background:rgb(241,245,254);}\n .audible-frog{background:#e6ede6;}\n .audible-sky span, .audible-sky button{color:rgb(31,106,219);} \n ",e+=" .pw-audible-btn{background: none; border: none; color: #4f6e46; margin: 0 5px;} \n",e+=" .pw-pen-yellow{-webkit-box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,255,193,0.5);} \n ",e+=" .pw-pen-green{-webkit-box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(193,255,200,0.5);}\n ",e+=" .pw-pen-red{-webkit-box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,193,193,0.5);} \n ",e+="  @media print{.audible-media-player{display:none;} }\n";var n=function(a,e){if(!e||!document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.innerHTML=a,e&&(n.id=e),document.getElementsByTagName("head")[0].appendChild(n)}};n(e,"audible_css");var t=function(e){e.fn.snpt_overlaypen=function(a){this.old_display||(this.old_display=this.css("display")),this.old_position||(this.old_position=this.css("position")),this.css({position:"relative",display:"inline-block"});for(var n=e.extend({width:"15px",height:"60%",background:"orange",opacity:"0.37","z-index":"100","border-radius":"20%"},a),t=Object.keys(n),r=[],o=0,i=t.length;i>o;o++){var s=t[o];r.push(s+":"+n[s])}var p=e('<div class="pw-overlaypen" style="position:absolute;'+r.join(";")+'"></div>');return this.append(p),this},e.fn.snpt_erasepen=function(){this.css({position:this.old_position,display:this.old_display}),this.find(".pw-overlaypen").remove()},e.fn.snpt_player=function(n){if(!window.Audio)return console.error("No HTML5 Audio support"),this;var t=e.extend({id:"p"+Math.random().toString(32).substring(2),src:[],skin:"frog",css:""},n),r="";t.css&&(r='style="'+t.css+'"');var o=!1,i=new Audio;i.id=t.id,a[t.id]=i;var s=e('<button class="pw-audible-btn" style="background: none; border: none; margin: 0 5px;" id="'+t.id+'_stop"><i class="fa fas fa-sync"></i></button>'),p=e('<input type="range" value="0" min="0" max="100" style="margin-left:5px;flex-grow:96;"/>'),d=e('<span style="margin-left:5px;font-family:arial;">00:00</span>'),l=e('<button style="background: none; border: none; margin: 0 5px;" class="pw-audible-btn"><i class="fa fas fa-play"></i></button>'),u=e('<div class="audible-media-player audible-'+t.skin+'" '+r+' id="pwmplayer_'+t.id+'" title="AudioPlayer by Josep Mulet"></div>');e.each(t.src,function(a,n){var r=e('<source id="'+t.id+"_src"+a+'" src="'+n+'"></source>');e(i).append(r)}),i.load(),i.addEventListener("loadeddata",function(){var a=i.duration;s.on("click",function(a){i.pause(),e(l).html('<i class="fa fas fa-play"></i>'),i.currentTime=0,d.html("00:00"),p.val(0),t.onStop&&t.onStop()}),l.on("click",function(a){i.stopped=!1,i.paused?(i.play(),e(l).html('<i class="fa fas fa-pause"></i>')):(i.pause(),e(l).html('<i class="fa fas fa-play"></i>'))}),i.addEventListener("timeupdate",function(e){var n=e.target;if(!o){var r=Math.floor(n.currentTime),i=Math.floor(r/60)+"",s=r-60*i+"";i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),d.html(i+":"+s);var l=Math.round(100*r/a);p.val(l),t.onTimeupdate&&t.onTimeupdate(n.currentTime)}}),i.addEventListener("ended",function(a){var n=e(a.target);n.val(100),e(l).html('<i class="fa fas fa-play"></i>'),d.html("00:00"),p.val(0),i.stopped=!0,i.currentTime=0}),p.on("mousedown",function(a){o=!0}),p.on("mouseup",function(a){o=!1}),p.on("change",function(n){var t=n.target,r=Math.floor(.01*e(t).val()*a),o=Math.floor(r/60)+"",s=r-60*o+"";o.length<2&&(o="0"+o),s.length<2&&(s="0"+s),d.html(o+":"+s),0==r&&d.html("00:00"),i.currentTime=r}),u.append(l),u.append(p),u.append(d),u.append(s),t.accordion&&t.accordion.on("click",function(a){i.pause(),e(l).html('<i class="fa fas fa-play"></i>')})}),this.prepend(u)},e.fn.snpt_narracio=function(a){var n=this,t=n.parent(),r="";t&&(t=t.parent(),t&&(r=t.attr("data-lang")));var o=n.find("a.accordion-toggle");o&&("ca"==r?o.append(e('<span title="Explicació en àudio"> narrada </span>')):"es"==r?o.append(e('<span title="Explicación con audio"> narrada </span>')):"en"==r&&o.append(e('<span title="Explanation with audio"> with audio </span>')),o.append(e('<i class="fa fas fa-headphones"></i>')));var i=n.find(".accordion-inner"),s=n.attr("data-audible"),p=s,d=[];if(p.startsWith("http"))for(var l=p.split(","),u=0,c=l.length;c>u;u++)d.push(l[u].trim());else p="https://piworld.es/iedib/audible/"+s,d.push(p+".m4a"),d.push(p+".mp3");var f=n.find("[data-from]"),h=n.find("[data-laser]"),x=n.find("[data-pen]");f.each(function(a,n){var t=e(n).attr("data-from");n.fromTime=t}),h.each(function(a,n){var t=e(n).attr("data-laser");n.lasers=[];for(var r=t.split("|"),o=0,i=r.length;i>o;o++){var s=r[o],p=s.split(",");if(p.length>=2){var d=0,l=0,u="md";d=parseInt(p[0]),l=parseInt(p[1]),p.length>2&&(u=(p[2]||"md").trim().toLowerCase()),n.lasers.push({start:d,end:l,pos:u})}else console.error("Invalid laser ",s)}}),x.each(function(a,n){var t=e(n).attr("data-pen");n.pen=[];for(var r=t.split("|"),o=0,i=r.length;i>o;o++){var s=r[o],p=s.split(",");if(3===p.length){var d=0,l=0,u={};d=parseInt(p[0]),l=parseInt(p[1]);for(var c=p[2].split(";"),a=0,f=c.length;f>a;a++){var h=c[a],x=h.split(":");if(2==x.length){var b=x[0].trim(),v=x[1].trim();u[b]=v}}n.pen.push({start:d,end:l,opts:u})}else console.error("Invalid penmarker ",s)}});var b=function(a){if(0==a)return f.fadeTo("fast",1),h.removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se"),void x.each(function(a,n){var t=e(n);t.snpt_erasepen()});for(var n=0,t=f.length;t>n;n++){var r=f[n];r.fromTime>a?e(r).fadeTo("fast",0):e(r).fadeTo("fast",1)}for(var n=0,t=h.length;t>n;n++){for(var r=h[n],o=null,i=0,s=r.lasers.length;s>i;i++){var p=r.lasers[i];if(p.start<=a&&a<=p.end){o=p.pos;break}}o?e(r).addClass("pw-laser-"+o):e(r).removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se")}for(var n=0,t=x.length;t>n;n++){var r=x[n],d=e(r);d.each(function(a,n){var t=e(n);t.snpt_erasepen()});for(var i=0,s=r.pen.length;s>i;i++){var p=r.pen[i];if(p.start<=a&&a<=p.end){var l=p.opts;l&&d.snpt_overlaypen(l)}}}},v=function(){f.fadeTo("fast",1)};i.snpt_player({id:s,src:d,onTimeupdate:b,onStop:v,accordion:o})}},r=function(a,e){return e=e||0,window.require&&"function"==typeof window.require?void a():e>15?void console.error("Talea:: Cannot find requirejs"):void window.setTimeout(function(){r(a,e+1)},500)};r(function(){require(["jquery"],function(a){a(function(){t(a),a('[role="snptd_narracio"]').each(function(e,n){a(n).snpt_narracio()})})})})}();
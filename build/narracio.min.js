window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; !function(){var a={},e=' .pw-laser-nw{position:relative;}\n .pw-laser-nw::after{content:"";position:absolute;left:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ';e+=' .pw-laser-ne{position:relative;}\n .pw-laser-ne::after{content:"";position:absolute;right:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-sw{position:relative;}\n .pw-laser-sw::after{content:"";position:absolute;left:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;} \n',e+=' .pw-laser-se{position:relative;}\n .pw-laser-se::after{content:"";position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-md{position:relative;}\n .pw-laser-md::after{content:"";position:absolute;left:50%;bottom:50%;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=" .audible-media-player{max-width:600px;padding:6px;border-radius:7px;display:flex;margin:auto;margin-bottom:15px;}\n ",e+="  \n .audible-frog span, .audible-frog button{color: #4f6e46;}\n .audible-sky{background:rgb(241,245,254);}\n .audible-frog{background:#e6ede6;}\n .audible-sky span, .audible-sky button{color:rgb(31,106,219);} \n ",e+=" .pw-audible-btn{background: none; border: none; color: #4f6e46; margin: 0 5px;} \n",e+=" .pw-pen-yellow{-webkit-box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,255,193,0.5);} \n ",e+=" .pw-pen-green{-webkit-box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(193,255,200,0.5);}\n ",e+=" .pw-pen-red{-webkit-box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,193,193,0.5);} \n ",e+="  @media print{.audible-media-player{display:none;} }\n";var n=function(a,e){if(!e||!document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.innerHTML=a,e&&(n.id=e),document.getElementsByTagName("head")[0].appendChild(n)}};n(e,"audible_css"),$.fn.snpt_overlaypen=function(a){this.old_display||(this.old_display=this.css("display")),this.old_position||(this.old_position=this.css("position")),this.css({position:"relative",display:"inline-block"});for(var e=$.extend({width:"15px",height:"60%",background:"orange",opacity:"0.37","z-index":"100","border-radius":"20%"},a),n=Object.keys(e),t=[],r=0,o=n.length;o>r;r++){var i=n[r];t.push(i+":"+e[i])}var s=$('<div class="pw-overlaypen" style="position:absolute;'+t.join(";")+'"></div>');return this.append(s),this},$.fn.snpt_erasepen=function(){this.css({position:this.old_position,display:this.old_display}),this.find(".pw-overlaypen").remove()},$.fn.snpt_player=function(e){if(!window.Audio)return console.error("No HTML5 Audio support"),this;var n=$.extend({id:"p"+Math.random().toString(32).substring(2),src:[],skin:"frog",css:""},e),t="";n.css&&(t='style="'+n.css+'"');var r=!1,o=new Audio;o.id=n.id,a[n.id]=o;var i=$('<button class="pw-audible-btn" style="background: none; border: none; margin: 0 5px;" id="'+n.id+'_stop"><i class="fa fas fa-sync"></i></button>'),s=$('<input type="range" value="0" min="0" max="100" style="margin-left:5px;flex-grow:96;"/>'),p=$('<span style="margin-left:5px;font-family:arial;">00:00</span>'),d=$('<button style="background: none; border: none; margin: 0 5px;" class="pw-audible-btn"><i class="fa fas fa-play"></i></button>'),l=$('<div class="audible-media-player audible-'+n.skin+'" '+t+' id="pwmplayer_'+n.id+'" title="AudioPlayer by Josep Mulet"></div>');$.each(n.src,function(a,e){var t=$('<source id="'+n.id+"_src"+a+'" src="'+e+'"></source>');$(o).append(t)}),o.load(),o.addEventListener("loadeddata",function(){var a=o.duration;i.on("click",function(a){o.pause(),$(d).html('<i class="fa fas fa-play"></i>'),o.currentTime=0,p.html("00:00"),s.val(0),n.onStop&&n.onStop()}),d.on("click",function(a){o.stopped=!1,o.paused?(o.play(),$(d).html('<i class="fa fas fa-pause"></i>')):(o.pause(),$(d).html('<i class="fa fas fa-play"></i>'))}),o.addEventListener("timeupdate",function(e){var t=e.target;if(!r){var o=Math.floor(t.currentTime),i=Math.floor(o/60)+"",d=o-60*i+"";i.length<2&&(i="0"+i),d.length<2&&(d="0"+d),p.html(i+":"+d);var l=Math.round(100*o/a);s.val(l),n.onTimeupdate&&n.onTimeupdate(t.currentTime)}}),o.addEventListener("ended",function(a){var e=$(a.target);e.val(100),$(d).html('<i class="fa fas fa-play"></i>'),p.html("00:00"),s.val(0),o.stopped=!0,o.currentTime=0}),s.on("mousedown",function(a){r=!0}),s.on("mouseup",function(a){r=!1}),s.on("change",function(e){var n=e.target,t=Math.floor(.01*$(n).val()*a),r=Math.floor(t/60)+"",i=t-60*r+"";r.length<2&&(r="0"+r),i.length<2&&(i="0"+i),p.html(r+":"+i),0==t&&p.html("00:00"),o.currentTime=t}),l.append(d),l.append(s),l.append(p),l.append(i),n.accordion&&n.accordion.on("click",function(a){o.pause(),$(d).html('<i class="fa fas fa-play"></i>')})}),this.prepend(l)},$.fn.snpt_narracio=function(a){var e=this,n=e.parent(),t="";n&&(n=n.parent(),n&&(t=n.attr("data-lang")));var r=e.find("a.accordion-toggle");r&&("ca"==t?r.append($('<span title="Explicació en àudio"> narrada </span>')):"es"==t?r.append($('<span title="Explicación con audio"> narrada </span>')):"en"==t&&r.append($('<span title="Explanation with audio"> with audio </span>')),r.append($('<i class="fa fas fa-headphones"></i>')));var o=e.find(".accordion-inner"),i=e.attr("data-audible"),s=i,p=[];if(s.startsWith("http"))for(var d=s.split(","),l=0,c=d.length;c>l;l++)p.push(d[l].trim());else s="https://piworld.es/iedib/audible/"+i,p.push(s+".m4a"),p.push(s+".mp3");var f=e.find("[data-from]"),u=e.find("[data-laser]"),h=e.find("[data-pen]");f.each(function(a,e){var n=$(e).attr("data-from");e.fromTime=n}),u.each(function(a,e){var n=$(e).attr("data-laser");e.lasers=[];for(var t=n.split("|"),r=0,o=t.length;o>r;r++){var i=t[r],s=i.split(",");if(s.length>=2){var p=0,d=0,l="md";p=parseInt(s[0]),d=parseInt(s[1]),s.length>2&&(l=(s[2]||"md").trim().toLowerCase()),e.lasers.push({start:p,end:d,pos:l})}else console.error("Invalid laser ",i)}}),h.each(function(a,e){var n=$(e).attr("data-pen");e.pen=[];for(var t=n.split("|"),r=0,o=t.length;o>r;r++){var i=t[r],s=i.split(",");if(3===s.length){var p=0,d=0,l={};p=parseInt(s[0]),d=parseInt(s[1]);for(var c=s[2].split(";"),a=0,f=c.length;f>a;a++){var u=c[a],h=u.split(":");if(2==h.length){var x=h[0].trim(),b=h[1].trim();l[x]=b}}e.pen.push({start:p,end:d,opts:l})}else console.error("Invalid penmarker ",i)}});var x=function(a){if(0==a)return f.fadeTo("fast",1),u.removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se"),void h.each(function(a,e){var n=$(e);n.snpt_erasepen()});for(var e=0,n=f.length;n>e;e++){var t=f[e];t.fromTime>a?$(t).fadeTo("fast",0):$(t).fadeTo("fast",1)}for(var e=0,n=u.length;n>e;e++){for(var t=u[e],r=null,o=0,i=t.lasers.length;i>o;o++){var s=t.lasers[o];if(s.start<=a&&a<=s.end){r=s.pos;break}}r?$(t).addClass("pw-laser-"+r):$(t).removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se")}for(var e=0,n=h.length;n>e;e++){var t=h[e],p=$(t);p.each(function(a,e){var n=$(e);n.snpt_erasepen()});for(var o=0,i=t.pen.length;i>o;o++){var s=t.pen[o];if(s.start<=a&&a<=s.end){var d=s.opts;d&&p.snpt_overlaypen(d)}}}},b=function(){f.fadeTo("fast",1)};o.snpt_player({id:i,src:p,onTimeupdate:x,onStop:b,accordion:r})};var t=function(a,e){return e=e||0,window.$&&"function"==typeof window.$?void a():e>15?void console.error("Narracio:: Cannot find jQuery"):void window.setTimeout(function(){t(a,e+1)},500)};t(function(){$('[role="snptd_narracio"]').each(function(a,e){$(e).snpt_narracio()})})}();
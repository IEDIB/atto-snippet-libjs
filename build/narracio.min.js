window.IB = window.IB || {}; window.IB.sd = window.IB.sd || {}; $(function(){var a={},e=' .pw-laser-nw{position:relative;}\n .pw-laser-nw::after{content:"";position:absolute;left:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ';e+=' .pw-laser-ne{position:relative;}\n .pw-laser-ne::after{content:"";position:absolute;right:0;top:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-sw{position:relative;}\n .pw-laser-sw::after{content:"";position:absolute;left:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;} \n',e+=' .pw-laser-se{position:relative;}\n .pw-laser-se::after{content:"";position:absolute;right:0;bottom:0;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=' .pw-laser-md{position:relative;}\n .pw-laser-md::after{content:"";position:absolute;left:50%;bottom:50%;width:10px;height:10px;border-radius:50%;background:rgba(255,0,0,0.6);box-shadow: 0 0 5px 3px red;}\n ',e+=" .audible-media-player{max-width:600px;padding:6px;border-radius:7px;display:flex;margin:auto;margin-bottom:15px;}\n ",e+="  \n .audible-frog span, .audible-frog button{color: #4f6e46;}\n .audible-sky{background:rgb(241,245,254);}\n .audible-frog{background:#e6ede6;}\n .audible-sky span, .audible-sky button{color:rgb(31,106,219);} \n ",e+=" .pw-audible-btn{background: none; border: none; color: #4f6e46; margin: 0 5px;} \n",e+=" .pw-pen-yellow{-webkit-box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #ff0 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,255,193,0.5);} \n ",e+=" .pw-pen-green{-webkit-box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #3f3 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(193,255,200,0.5);}\n ",e+=" .pw-pen-red{-webkit-box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);box-shadow: #FFF 0 -1px 4px, #f33 0 -2px 10px, 5px 5px 15px 5px rgba(0,0,0,0);background: rgb(255,193,193,0.5);} \n ",e+="  @media print{.audible-media-player{display:none;} }\n";var n=function(a,e){if(!e||!document.getElementById(e)){var n=document.createElement("style");n.type="text/css",n.innerHTML=a,e&&(n.id=e),document.getElementsByTagName("head")[0].appendChild(n)}};n(e,"audible_css"),$.fn.snpt_overlaypen=function(a){this.old_display||(this.old_display=this.css("display")),this.old_position||(this.old_position=this.css("position")),this.css({position:"relative",display:"inline-block"});for(var e=$.extend({width:"15px",height:"60%",background:"orange",opacity:"0.37","z-index":"100","border-radius":"20%"},a),n=Object.keys(e),t=[],r=0,o=n.length;o>r;r++){var s=n[r];t.push(s+":"+e[s])}var i=$('<div class="pw-overlaypen" style="position:absolute;'+t.join(";")+'"></div>');return this.append(i),this},$.fn.snpt_erasepen=function(){this.css({position:this.old_position,display:this.old_display}),this.find(".pw-overlaypen").remove()},$.fn.snpt_player=function(e){if(!window.Audio)return console.error("No HTML5 Audio support"),this;var n=$.extend({id:"p"+Math.random().toString(32).substring(2),src:[],skin:"frog",css:""},e),t="";n.css&&(t='style="'+n.css+'"');var r=!1,o=new Audio;o.id=n.id,a[n.id]=o;var s=$('<button class="pw-audible-btn" style="background: none; border: none; margin: 0 5px;" id="'+n.id+'_stop"><i class="fas fa-sync"></i></button>'),i=$('<input type="range" value="0" min="0" max="100" style="margin-left:5px;flex-grow:96;"/>'),p=$('<span style="margin-left:5px;font-family:arial;">00:00</span>'),l=$('<button style="background: none; border: none; margin: 0 5px;" class="pw-audible-btn"><i class="fas fa-play"></i></button>'),d=$('<div class="audible-media-player audible-'+n.skin+'" '+t+' id="pwmplayer_'+n.id+'" title="AudioPlayer by Josep Mulet"></div>');$.each(n.src,function(a,e){var t=$('<source id="'+n.id+"_src"+a+'" src="'+e+'"></source>');$(o).append(t)}),o.load(),o.addEventListener("loadeddata",function(){var a=o.duration;s.on("click",function(a){o.pause(),$(l).html('<i class="fas fa-play"></i>'),o.currentTime=0,p.html("00:00"),i.val(0),n.onStop&&n.onStop()}),l.on("click",function(a){o.stopped=!1,o.paused?(o.play(),$(l).html('<i class="fas fa-pause"></i>')):(o.pause(),$(l).html('<i class="fas fa-play"></i>'))}),o.addEventListener("timeupdate",function(e){var t=e.target;if(!r){var o=Math.floor(t.currentTime),s=Math.floor(o/60)+"",l=o-60*s+"";s.length<2&&(s="0"+s),l.length<2&&(l="0"+l),p.html(s+":"+l);var d=Math.round(100*o/a);i.val(d),n.onTimeupdate&&n.onTimeupdate(t.currentTime)}}),o.addEventListener("ended",function(a){var e=$(a.target);e.val(100),$(l).html('<i class="fas fa-play"></i>'),p.html("00:00"),i.val(0),o.stopped=!0,o.currentTime=0}),i.on("mousedown",function(a){r=!0}),i.on("mouseup",function(a){r=!1}),i.on("change",function(e){var n=e.target,t=Math.floor(.01*$(n).val()*a),r=Math.floor(t/60)+"",s=t-60*r+"";r.length<2&&(r="0"+r),s.length<2&&(s="0"+s),p.html(r+":"+s),0==t&&p.html("00:00"),o.currentTime=t}),d.append(l),d.append(i),d.append(p),d.append(s),n.accordion&&n.accordion.on("click",function(a){o.pause(),$(l).html('<i class="fas fa-play"></i>')})}),this.prepend(d)},$.fn.snpt_narracio=function(a){var e=this,n=e.parent(),t="";n&&(n=n.parent(),n&&(t=n.attr("data-lang")));var r=e.find("a.accordion-toggle");r&&("ca"==t?r.append($('<span title="Explicació en àudio"> narrada </span>')):"es"==t?r.append($('<span title="Explicación con audio"> narrada </span>')):"en"==t&&r.append($('<span title="Explanation with audio"> with audio </span>')),r.append($('<i class="fas fa-headphones"></i>')));var o=e.find(".accordion-inner"),s=e.attr("data-audible"),i=s,p=[];if(i.startsWith("http"))for(var l=i.split(","),d=0,c=l.length;c>d;d++)p.push(l[d].trim());else i="https://piworld.es/iedib/audible/"+s,p.push(i+".m4a"),p.push(i+".mp3");var u=e.find("[data-from]"),f=e.find("[data-laser]"),h=e.find("[data-pen]");u.each(function(a,e){var n=$(e).attr("data-from");e.fromTime=n}),f.each(function(a,e){var n=$(e).attr("data-laser");e.lasers=[];for(var t=n.split("|"),r=0,o=t.length;o>r;r++){var s=t[r],i=s.split(",");if(i.length>=2){var p=0,l=0,d="md";p=parseInt(i[0]),l=parseInt(i[1]),i.length>2&&(d=(i[2]||"md").trim().toLowerCase()),e.lasers.push({start:p,end:l,pos:d})}else console.error("Invalid laser ",s)}}),h.each(function(a,e){var n=$(e).attr("data-pen");e.pen=[];for(var t=n.split("|"),r=0,o=t.length;o>r;r++){var s=t[r],i=s.split(",");if(3===i.length){var p=0,l=0,d={};p=parseInt(i[0]),l=parseInt(i[1]);for(var c=i[2].split(";"),a=0,u=c.length;u>a;a++){var f=c[a],h=f.split(":");if(2==h.length){var x=h[0].trim(),b=h[1].trim();d[x]=b}}e.pen.push({start:p,end:l,opts:d})}else console.error("Invalid penmarker ",s)}});var x=function(a){if(0==a)return u.fadeTo("fast",1),f.removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se"),void h.each(function(a,e){var n=$(e);n.snpt_erasepen()});for(var e=0,n=u.length;n>e;e++){var t=u[e];t.fromTime>a?$(t).fadeTo("fast",0):$(t).fadeTo("fast",1)}for(var e=0,n=f.length;n>e;e++){for(var t=f[e],r=null,o=0,s=t.lasers.length;s>o;o++){var i=t.lasers[o];if(i.start<=a&&a<=i.end){r=i.pos;break}}r?$(t).addClass("pw-laser-"+r):$(t).removeClass("pw-laser-md").removeClass("pw-laser-nw").removeClass("pw-laser-ne").removeClass("pw-laser-sw").removeClass("pw-laser-se")}for(var e=0,n=h.length;n>e;e++){var t=h[e],p=$(t);p.each(function(a,e){var n=$(e);n.snpt_erasepen()});for(var o=0,s=t.pen.length;s>o;o++){var i=t.pen[o];if(i.start<=a&&a<=i.end){var l=i.opts;l&&p.snpt_overlaypen(l)}}}},b=function(){u.fadeTo("fast",1)};o.snpt_player({id:s,src:p,onTimeupdate:x,onStop:b,accordion:r})},$('[role="snptd_narracio"]').each(function(a,e){$(e).snpt_narracio()})});